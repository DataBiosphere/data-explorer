from datetime import date
import json

from elasticsearch import Elasticsearch
from elasticsearch_dsl import FacetedSearch
from elasticsearch_dsl import TermsFacet
from flask import current_app


def facets_get():
    """
    facets_get
    Returns facets.

    :rtype: str
    """
    #fs = FacetedSearch()
    #fs.index = _get_index_name()
    #fs.using = Elasticsearch('elasticsearch:9200')
    #fs.__init__()
    #response = fs.execute()
    #return response
    return 'sdf'


# The only way to use FacetedSearch is to subclass it (!).
#class DatasetSearch(FacetedSearch):
#  index = _get_index_name()


def _get_index_name():
    """Gets index name from /app/dataset.json."""
    # JSON doesn't support comments
    # (https://plus.google.com/+DouglasCrockfordEsq/posts/RK8qyGVaGSr). Remove
    # comments before parsing.
    with open('/app/dataset.json') as f:
      dataset = json.loads('\n'.join([row for row in f.readlines() if len(row.split('//')) == 1]))
      current_app.logger.info(dataset)
      return dataset['name']
